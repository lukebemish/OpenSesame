plugins {
    alias libs.plugins.managedversioning
    alias libs.plugins.nexuspublish
}

managedVersioning {
    versionFile.set rootProject.file('version.properties')
    if (System.getenv('PR_NUMBER')) {
        suffixParts.add "pr${System.getenv('PR_NUMBER')}"
    } else if (System.getenv('SNAPSHOT_MAVEN_URL')) {
        suffixParts.add 'SNAPSHOT'
    }
}

managedVersioning.apply()

println "Building: ${rootProject.version}"

if (!System.getenv('PR_NUMBER') && !System.getenv('SNAPSHOT_MAVEN_URL')) {
    nexusPublishing {
        repositories {
            sonatype {
                username.set(System.getenv('SONATYPE_USER') ?: '')
                password.set(System.getenv('SONATYPE_PASSWORD') ?: '')
                nexusUrl.set(uri("https://s01.oss.sonatype.org/service/local/"))
            }
        }
    }
}